 <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food Website</title>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link rel="stylesheet" th:href="@{/css/foodread.css}">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
	integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
	crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="short icon" th:href="@{/image/food/short_icon.png}">
<script>
$(document).ready(function(){
	//찜 버튼을 클릭하면 insertzzim()함수 호출 
	$('#submit').click(insertzzim);

});

//찜 저장
function insertzzim(){
	
	let recipe_num = $('#recipe_num').val();
	let zzim_name = $('#zzim_name').html();
	let zzim_originalfile = $('#zzim_originalfile').val();
	let zzim_savedfile = $('#zzim_savedfile').val();
	let zzim_need = $('#zzim_need').html();
	let zzim_howto = $('#zzim_howto').html();
	let zzim_type = $('#zzim_type').html();
	let zzim_icon = $('#zzim_icon').html();
	
	$.ajax({
		url: 'insertzzim',
		type: 'post',
		data: {recipe_num: recipe_num
			,zzim_name: zzim_name
			,zzim_originalfile: zzim_originalfile
			,zzim_savedfile: zzim_savedfile
			,zzim_need: zzim_need
			,zzim_howto: zzim_howto
			,zzim_type: zzim_type
			,zzim_icon: zzim_icon
			},
		success: function(result){
			if(result == 1) 
			alert('찜 저장되었습니다.');
			else{
			alert('이미 저장되어 있습니다.');}			
		},
		error: function(){
			alert('로그인 후 이용가능합니다.');
			 window.open('../user/loginForm', 'parent', 'width=700px,height=800px,scrollbars=yes');
		}	
	});
}	


</script>


<script type="text/javascript">
		//레시피 삭제 
		function deleterecipe(n){
			if (confirm('삭제하시겠습니까?')){
			location.href='delete?num=' + n;
			}
		}
	    //리플 삭제
	    function deleteComment(comment_num, recipe_num) {
	    	if (confirm('삭제하시겠습니까?')) {
	    		location.href = 'deleteComment?comment_num=' + comment_num + '&recipe_num=' + recipe_num;
	    	}
	    }
    	  
    </script>

</head>
<body>

	<section id="Home">

        <nav>

            <div class="logo">
                <a th:href="@{/}"> <img th:src="@{/image/food/로고0328_3.svg}"></a>
            </div>

            <ul>
                <li><a th:href="@{/}"> 레시피 추천</a></li>
                <li><a th:href="@{/recipe/list}">모든 레시피보기</a></li>
                <!-- 아래부터는 로그인 해야 이용 가능한 설정 클릭시 로그인한 사람이 아니면 로그인 페이지로 접근 막음  -->
                <!-- 로그인을 3개페이지 이용가능  접근허용 이렇게 할려면 홈에 컨크롤러가 있으면 안되고 아래 3개는 각각의 컨트롤러에 있어서 아이디 채크후 가야할꺼같음-->
                <!-- 구현이 까다로울꺼같은면 발표 전에 로그인 먼저 한다고 말하고 보여주는 방법이 있으면-->
                
                <li><a th:href="@{/recipe/write}">레시피 쓰기</a></li>
                <li><a th:href="@{/recipe/listzzim}">내 찜목록</a></li>
                <li><a th:href="@{/user/mypage}">마이페이지</a></li>
            </ul>

            <div class="login">
                <span sec:authorize="not isAuthenticated()" ><a th:href="@{/user/loginForm}">로그인</a></span>
                <span sec:authorize="isAuthenticated()" ><a th:href="@{/user/logout}">로그아웃</a></span>
            </div>

        </nav>

    </section>

	<form id="readRecipe" th:action="@{/recipe/read}" method="post">

		<table>
			<tr>

				<!-- 화면에 바로뜸.  -->
				<img th:src="@{/recipe/download(num=${recipe.recipe_num})}">
				<!-- 이렇게 하는 경우도 있고, 저장 장소를 static에 해서 누구든지 볼수 있게 할수도 있다고함....있다고함..  -->

			</tr>
			<input type="hidden" name="recipe_num" th:value="${recipe.recipe_num}" id="recipe_num">
			<input type="hidden" name="zzim_originalfile" th:value="${recipe.recipe_originalfile}" id="zzim_originalfile">
			<input type="hidden" name="zzim_savedfile" th:value="${recipe.recipe_savedfile}" id="zzim_savedfile">
			<tr>
				<th>요리 제목</th>
				<td th:text="${recipe.recipe_name}"  id="zzim_name"></td>
			</tr>
			<tr>
				<th>레시피 분류</th>
				<td th:text="${recipe.recipe_type}" id="zzim_type"></td>
			</tr>
			<tr>
				<th>레시피 아이콘</th>
				<td th:text="${recipe.recipe_icon}"  id="zzim_icon"></td>
			</tr>
			<tr>
				<th>레시피 조회수</th>
				<td th:text="${recipe.recipe_hit}"></td>
			</tr>
			<tr>
				<th>레시피 찜수</th>
				<td th:text="${recipe.recipe_zzimSum}"></td>
			</tr>
			<tr>
				<th>레시피 찜버튼</th>
				<td><input type="button" id="submit" value="찜"></td>
			<!-- 	<td><a th:href="@{/recipe/insertzzim(num=${recipe.recipe_num})}">찜</a></td> -->
			</tr>
			<tr>
				<th>작성자 아이디</th>
				<td th:text="${recipe.user_id}" ></td>
			</tr>
			<tr>
				<th>글 작성 날짜</th>
				<td th:text="${recipe.recipe_date}" ></td>
			</tr>
			<tr>
				<th>재료</th>
				<td th:text="${recipe.recipe_need}" id="zzim_need"></td>
			</tr>
			<tr>
				<th>요리 순서</th>
				<td th:utext="${recipe.recipe_howto}" id="zzim_howto"></td>
			</tr>
		</table>
	</form>
	<!-- 본인글일때 출력 -->
	<span th:if="${#authentication.name} == ${recipe.user_id}">
		<a th:href="@{/recipe/update(recipe_num=${recipe.recipe_num})}">수정</a> 
		<a th:href="|javascript:deleterecipe(${recipe.recipe_num})|">삭제</a>
	</span>

	<!-- 로그인했을때 출력되는 댓글 작성 폼 -->
	<div sec:authorize="isAuthenticated()">
		<form th:action="@{/recipe/writeComment}" method="post"
			onsubmit="return validation()">
			<input type="hidden" name="recipe_num"
				th:value="${recipe.recipe_num}"> <input type="text"
				name="comment_text" id="comment_text" style="width: 500px;">
			<input type="submit" value="확인">
		</form>
	</div>

	<!-- 현재 글의 댓글들 출력 -->
	<table>
		<tr th:each="comment : ${commentlist}">
			<td th:text="${comment.user_id}"></td>
			<td th:text="${comment.comment_text}"></td>
			<td th:text="${comment.comment_date}"></td>

			<!-- 자기 댓글 삭제 -->

			<td><span th:if="${#authentication.name} == ${comment.user_id}">
					<a
					th:href="|javascript:deleteComment(${comment.comment_num}, ${comment.recipe_num})|">
						<img th:src="@{/image/icon_delete_24.png}">
				</a>
			</span></td>
		</tr>
	</table>

	</section>








	<!--밑에부분-->

	<footer>

		<div class="footer_main">

			<div class="footer_tag">

				<h2>Back-End</h2>
				<p>applemail486@gmail.com / 김지희</p>
				<p>jsyoo1029@gmail.com / 유진선</p>
				<p>entergo94@gmail.com / 정세원</p>


			</div>

			<div class="footer_tag">

				<h2></h2>
				<p></p>
				<p></p>
				<p></p>
				<p></p>
				<p></p>

			</div>

			<div class="footer_tag">

				<h2>Follows</h2>
				<i class="fa-brands fa-facebook-f"></i> <i
					class="fa-brands fa-twitter"></i> <i class="fa-brands fa-instagram"></i>
				<i class="fa-brands fa-linkedin-in"></i>

			</div>

			<div class="footer_tag">

				<h2></h2>
				<p></p>


			</div>

			<div class="footer_tag">

				<h2>Front-End</h2>
				<p>kimyeaji01@gmail.com / 김예지</p>
				<p>entergo94@gmail.com / 정세원</p>


			</div>

		</div>

	</footer>




</body>
</html>